<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dr Plus Live</title>
  <script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>
</head>
<body style="margin:0;padding:0;background:black;color:white;text-align:center;font-family:sans-serif;">

  <h2 id="status">Connecting...</h2>
  <video id="local_video" autoplay playsinline style="width:100%;max-height:50%;"></video>
  <div id="remote_video" style="width:100%;height:50%;background:#000;"></div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const appId = urlParams.get("appId");
    const token = urlParams.get("token");
    const channel = urlParams.get("channel");
    const role = urlParams.get("role"); // 'host' or 'audience'

    const client = AgoraRTC.createClient({ mode: "live", codec: "vp8" });
    client.setClientRole(role);

    async function start() {
      await client.init(appId);
      const uid = await client.join(appId, channel, token, null);
      document.getElementById("status").innerText = `Joined as ${role} - UID ${uid}`;

      if (role === "host") {
        const localStream = AgoraRTC.createStream({
          streamID: uid,
          audio: true,
          video: true,
          screen: false
        });
        localStream.init(() => {
          document.getElementById("status").innerText = "Broadcasting...";
          localStream.play("local_video");
          client.publish(localStream);
        });
      }

      client.on("stream-added", evt => {
        const stream = evt.stream;
        client.subscribe(stream);
      });

      client.on("stream-subscribed", evt => {
        const stream = evt.stream;
        document.getElementById("status").innerText = "Watching stream...";
        stream.play("remote_video");
      });
    }

    start();
  </script>
</body>
</html>
